## 1. Arduino 生態圈

AVR 的一大優勢在於 Arduino 的生態圈多數脫離不了 AVR，Arduino 提供了非常好的抽象，簡化了繁瑣的設定、編譯、上傳程式碼等步驟，透過 IDE 操作初學者也可以輕易將程式碼上傳。

儘管如此，背後運作的仍然是 AVR（這裡不討論以 ARM chip 的 Arduino 開發板），更棒的是 Arduino 是開源的，任何一個人都可以上 GitHub 查看原始碼。比起剛開始就直接挑戰 Linux 原始碼，從 AVR 開始除了程式碼規模較小之外，有任何問題都可以直接使用 Arduino 實機測試。

## 2. 架構簡單

比起 intel 或是 ARM 指令集，AVR 的指令集相對少很多，打開 Attiny85 的 datasheet 也就 120 個指令，在學習上也就相對好上手。以 Attiny85 的 datasheet 為例，整個 datasheet 也才 234 頁，還算是相對好消化的範圍。

## 3. 方便取得、操作

除了可以直接用 Arduino 來學習 AVR 之外，對於比較進階的學習者來說也可以直接買單顆 IC 來學習。以 Attiny85 為例，只有 8 隻腳而且可以直接插麵包板接線，想要測試程式碼運作時相對方便許多。Attiny85 只要 50 ~ 60 台幣就能入手，網路上隨便都買得到，比一杯飲料還便宜，燒掉也不會太心疼。

另外 AVR chip 常見的儲存機制都是內建在晶片當中，只要有電源，不用外接任何設備就可以直接運作

- flash memory
- EEPROM
- SRAM
- 內部時脈

## 學這個有用嗎？

學這個又沒有實際用途，為什麼還要大費周章學？

的確，學習整個作業系統是完全不同的概念，儘管你把 AVR 的指令跟概念搞熟也不代表明天就能寫 linux kernel（請右轉 jserv），但這無關於有沒有實際用途，而是對於事物本質運作的好奇。

因此，我認為有這個想法時心態就已經完全不正確了。如同本系列的說明文一樣，這是一段感謝電、感謝電晶體、感謝現代計算機組織發展的歷程。

回頭想想計算機的歷史，發現電的存在、電晶體、積體電路、CPU 架構、半導體產業，簡直就是奇蹟。能夠在 21 世紀學習人類最偉大的智慧結晶，這件事情本身就已經夠迷人了。

質數的存在，最剛開始也只侷限在數論而已，但多年以後質數成為了密碼學的重要基礎，我們仰賴的 HTTPS 加密傳輸，就是以質數的性質構築而成的。

因此如果真要給答案的話，**本系列文章對你的職涯、寫程式的功力、薪水沒有任何幫助**，請不要浪費時間閱讀，謝謝。

## 本系列文規劃

要在 30 天內講完 AVR 的所有知識是非常困難的挑戰，因此可能省略部份概念或以較為精簡的文字帶過，文章會貼出參考資源，有興趣的讀者可以另外參考。

1. 前導：電是如何產生的
2. 前導：電晶體如何組成邏輯閘
3. 前導：計算機當中的重要電路（暫存器、記憶體、全加器）
4. 前導：中斷
5. 前導：準備工具
6. 第一部份：AVR 介紹
7. 第二部份：重要功能介紹
    1. timer/counter
    2. GPIO port
    3. ADC
8. 第三部份：進階功能介紹
    1. watchdog
    2. interrupt
    3. UART
    4. sleep
    5. EEPROM
9. 第四部份：PCB 製作（如果時間許可）
    1. 電源管理模組
    2. 如何使用 KiCad
    3. 如何製作電路
    4. 如何下單並製作 PCB

電的產生方式來自於一個簡單的事實：電磁感應。在感應線圈裡如果磁通量發生變化就會產生電。

雖然在現代這被視為理所當然的事情，但法拉第也花了相當長的時間做實驗，才發現這個來自於大自然的奇妙原理。特斯拉後來利用電磁感應原理發明了發電機的結構，是現代發電的重要基礎。

開頭有提到，**磁場的變化**才能產生電，為了讓磁場產生變化則需要動能（也可透過其他方式），發電廠透過煤、天然氣、核能等方式將水煮沸後產生蒸氣，蒸氣驅動磁鐵旋轉，旋轉後產生電。這是支撐人類文明的重要基礎。

對我來說這件事情很神奇，看似很複雜的電，背後來自於一個簡單的事實：電磁感應。讓我們再次感謝法拉第、感謝特斯拉。

## 電與地球

雖然如此，人類用來發電的方式也對地球造成不少污染，根據世界衛生組織統計，目前溫室氣體排放的比例當中有 27% 來自於發電。

人們越來越仰賴電力的消費，雖然電本身相當環保，沒有任何污染。但產生電的方式有很大一部分還是仰賴煤、天然氣。

![截圖 2021-09-14 下午8.15.29.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4c7ba725-6b46-4125-813f-6c579166efef/截圖_2021-09-14_下午8.15.29.png)

儘管已經有各種環保的發電科技正在發展，但離完全取代傳統發電還有很長一段路要走。

## 交流電與直流電

在台灣使用的插座電力為 110V/60Hz，如果就這樣將電直接送進去電子產品的話馬上就會壞掉。電子產品大多仰賴於邏輯信號，也就是透過高電位模擬 1，低電位模擬 0 的方式運作。除了 110V 的電壓會將大部分的零件給燒壞之外，不斷變化電位的交流電也會讓 0 與 1 的判斷變得不準確，因此我們需要將交流電變成穩定電壓的直流電才能正常運作。

明明交流電的電壓隨時都在變化，那麼到底是什麼東西為 110V？這個 110V 是指交流電的**有效值，**交流電在電阻上所產生的瓦特數與直流電壓 110V 時一樣時就稱之為有效值。用有效值當作通稱也很自然，畢竟我們用電器在乎的就是瓦特數。

一般的電子產品，工作電壓通常會在 3.3V ~ 12V（根據產品不同）之間，我們要怎麼將交流電變成直流電呢？

交流電轉換為直流電的過程分為幾個階段：

- 整流
- 穩壓
- 降壓

### 整流

降壓過後的電，仍然處於交流電，因此沒辦法直接送進電子產品內使用，需要近一步整流。

交流轉換為直流的過程稱之為整流，整流可分為**全波整流**以及**半波整流。**

由於全波整流的轉換效益較佳，常見的整流方法是透過橋式整流器來實作。橋式整流器最主要的原理是透過二極體單向導通的特性所組成，當交流電經過橋式整流器時會將原本為負的半週期轉換為正的，因此轉換過後的波形會長這樣。

![截圖 2021-09-15 下午6.54.25.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0324850c-b190-434b-8c24-a38351c8df9f/截圖_2021-09-15_下午6.54.25.png)

雖然已經是直流電了，但仍然有幾個問題需要解決：

- 仍然有非常大的起伏，不是理想的直流電壓
- 變壓過後的電壓還是太大，大約在 140V 左右

我們可以透過加入電容的方式讓輸出電壓更加平滑，減少鏈波。電容具有充放電的特性，可以在輸出電壓達到峰值下降時，減緩電壓下降的速度，讓輸出電壓趨於平穩。

![圖片來自於維基百科](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a2ae47e3-61fa-426b-b878-0e8bcd76ea0f/Untitled.png)

圖片來自於維基百科

儘管如此，電壓還是很高，我們該如何降壓呢？

## 降壓

從 140V 降壓到 5V，必須透過變壓器的幫忙才行。變壓器的主要原理是透過電磁感應來實現的，因此...，我們需要將剛剛辛苦轉換好的直流電再次轉換為交流電...。

所以整個過程變成交流→ 直流 → 交流 → 直流嗎？是的。

> 你在開玩笑嗎？
> 

聽起來很可笑，但你我日常在用的充電器就是以這樣的方式組成的。做充電器的公司也不是白痴，這麼做背後有一個非常重要的目的—盡可能減少變壓器的面積。

在[維基百科](https://zh.wikipedia.org/wiki/%E5%8F%98%E5%8E%8B%E5%99%A8)當中有關於變壓器的轉換公式。雖然看起來有點複雜，但從公式中可以得知一個事實，輸入電壓的頻率越高，在磁力固定的情況下面積越小。

再講得直白一點，頻率越低，變壓器越大；頻率越高，變壓器越小。

![截圖 2021-09-15 下午8.22.22.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/59f31269-763a-48c6-842f-1b8e5045cd5a/截圖_2021-09-15_下午8.22.22.png)

因此，我們只要想辦法讓輸入電壓的頻率盡可能地高一點，就可以減少充電器的面積了。可是剛剛有提到輸入是直流電，要怎麼讓它再次變為交流電呢？答案是不斷地開開關關，既然電流有變化了，那麼當然可以產生電磁效應。

透過 MOSFET 或是 BJT 場效電晶體的開關特性，可以讓開關的頻率達到每秒 100KHz 甚至更高，這樣子的高頻率有助於減少變壓器的面積。這種電路也有個專有名詞，稱作 Flyback Converter（[維基百科](https://zh.wikipedia.org/wiki/%E8%BF%94%E9%A6%B3%E5%BC%8F%E8%AE%8A%E6%8F%9B%E5%99%A8)）。

好了，現在又變成交流電了，為了讓輸出再次變為直流電，在電路當中需要再次加入二極體與電容整流。

前面提到，一般的二極體雖具有單向導通的特性，但從導通切換到不導通的時間比較長，當頻率來到幾千赫茲後可能會不敷使用。為了因應這種高速切換的特性，通常會使用比較特殊的二極體—蕭特基二極體（Schottky Diode）來整流。

另外一個整流方式則是主動整流，或叫做同步整流，意思是透過電晶體的開關特性來整流。使用電晶體來整流最大的好處在於轉換的損失會比一般二極體來得小，但需要透過 IC 控制並加入更多元件，相對於使用蕭特基二極體來說比較複雜，成本也會比較高。

今年比較流行的話題 GAN 充電器，透過氮化鎵的特性，可以達到比一般電晶體更高的頻率，也就代表著變壓器可以在變得更小，或許也是值得關注的技術之一。

## 總結

今天這篇文章算是對電做了非常概括性的介紹，其重點在於現代用電是如何將交流電變成直流電給電子產品：

- 透過**橋式整流器**對交流電進行整流
- 使用電容（或是 pi 型整流）提高**有效電壓**並減少鏈波
- 使用變壓器降壓（Flyback Converter）
- 使用同步整流或是蕭特基二極體再次將交流變為直流

身為軟體工程師的我們，其實就是間接仰賴著電在討生活的，然而我發現我對這個來自大自然的禮物卻一無所知。

將交流電轉換成穩定直流電，再從產品的角度出發，如何將面積變得更小、減少損失、更安全，背後仍然是基礎科學的堆積，這應該就是 Engineering 的本質了吧。

